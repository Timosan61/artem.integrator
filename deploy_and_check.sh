#!/bin/bash
# üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–æ–≤
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./deploy_and_check.sh "commit message"

set -e  # –í—ã—Ö–æ–¥ –ø—Ä–∏ –æ—à–∏–±–∫–µ

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo -e "${BLUE}üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤${NC}"
echo "======================================================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–µ—Ä–µ–¥–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
if [ $# -eq 0 ]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞${NC}"
    echo -e "${YELLOW}–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./deploy_and_check.sh \"commit message\"${NC}"
    exit 1
fi

COMMIT_MESSAGE="$1"

# –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
echo -e "${BLUE}üì¶ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ git...${NC}"
git add .

# –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç
echo -e "${BLUE}üíæ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞...${NC}"
git commit -m "$COMMIT_MESSAGE

ü§ñ Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>"

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ GitHub
echo -e "${BLUE}üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ GitHub...${NC}"
git push origin whisper_golos

echo -e "${GREEN}‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ GitHub${NC}"
echo ""

# –ñ–¥–µ–º 2 –º–∏–Ω—É—Ç—ã –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–µ–ø–ª–æ—è
echo -e "${YELLOW}‚è∞ –û–∂–∏–¥–∞–Ω–∏–µ 2 –º–∏–Ω—É—Ç—ã –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–µ–ø–ª–æ—è Railway...${NC}"
echo "======================================================"

# –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç –ø–æ 30-—Å–µ–∫—É–Ω–¥–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º
for i in {4..1}; do
    remaining=$((i * 30))
    echo -e "${YELLOW}‚è±Ô∏è –û—Å—Ç–∞–ª–æ—Å—å ${remaining} —Å–µ–∫—É–Ω–¥...${NC}"
    sleep 30
done

echo -e "${GREEN}‚è∞ –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!${NC}"
echo ""

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ª–æ–≥–æ–≤
echo -e "${BLUE}üîç –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –¥–µ–ø–ª–æ—è...${NC}"
echo "======================================================"

./get_railway_logs.sh

echo ""
echo "======================================================"
echo -e "${GREEN}‚úÖ –î–µ–ø–ª–æ–π –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω—ã!${NC}"
echo ""
echo -e "${BLUE}üìù –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:${NC}"
echo -e "   ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è –≤—ã—à–µ"
echo -e "   ‚Ä¢ –ï—Å–ª–∏ –¥–µ–ø–ª–æ–π FAILED - –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ"
echo -e "   ‚Ä¢ –ï—Å–ª–∏ –¥–µ–ø–ª–æ–π SUCCESS - –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å"
echo -e "   ‚Ä¢ –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏: ${YELLOW}./get_railway_logs.sh${NC}"