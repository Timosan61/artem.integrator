# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø—Ä–æ–º–ø—Ç–æ–≤ —á–µ—Ä–µ–∑ YAML

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è MCP –∫–æ–º–∞–Ω–¥ —Ç–µ–ø–µ—Ä—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ YAML —Ñ–∞–π–ª—ã, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
- –ò–∑–º–µ–Ω—è—Ç—å —à–∞–±–ª–æ–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤
- –£–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ MCP

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### 1. `data/mcp_voice_prompts.yaml`

–≠—Ç–æ—Ç —Ñ–∞–π–ª —É–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥.

```yaml
voice_commands:
  system_prompt: |
    –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
    
  scenarios:
    - name: "–Ω–∞–∑–≤–∞–Ω–∏–µ_—Å—Ü–µ–Ω–∞—Ä–∏—è"
      triggers:
        - "—Ñ—Ä–∞–∑–∞ —Ç—Ä–∏–≥–≥–µ—Ä 1"
        - "—Ñ—Ä–∞–∑–∞ —Ç—Ä–∏–≥–≥–µ—Ä 2"
      action: "mcp__digitalocean__function_name"
      parameters: 
        query: {}
      response_template: |
        üì± **–®–∞–±–ª–æ–Ω –æ—Ç–≤–µ—Ç–∞:**
        {–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è}
```

#### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:

- **name**: –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Å—Ü–µ–Ω–∞—Ä–∏—è
- **triggers**: –°–ø–∏—Å–æ–∫ —Ñ—Ä–∞–∑, –∫–æ—Ç–æ—Ä—ã–µ –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π
- **action**: MCP —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–∑–æ–≤–∞
- **parameters**: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è MCP —Ñ—É–Ω–∫—Ü–∏–∏
- **fallback_message**: –°–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
- **response_template**: –®–∞–±–ª–æ–Ω —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞

### 2. `data/claude_sdk_prompts.yaml`

–≠—Ç–æ—Ç —Ñ–∞–π–ª —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏ –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏.

```yaml
system_prompt: |
  –û—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è Claude Code SDK

allowed_tools:
  digitalocean:
    apps:
      - mcp__digitalocean__list_apps
      - mcp__digitalocean__get_app

command_mappings:
  "/mcp apps": 
    prompt: "–ü—Ä–æ–º–ø—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã"
    tools: ["mcp__digitalocean__list_apps"]
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –≥–æ–ª–æ—Å–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ `mcp_voice_prompts.yaml`
2. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:

```yaml
- name: "check_status"
  triggers:
    - "–ø—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å"
    - "–∫–∞–∫–æ–π —Å—Ç–∞—Ç—É—Å"
    - "—Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã"
  action: "mcp__digitalocean__get_app_status"
  response_template: |
    üìä **–°—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
    {status_info}
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥—Ä–æ–ø–ª–µ—Ç–æ–≤ (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ)

1. –í `claude_sdk_prompts.yaml` —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ:

```yaml
droplets_future:
  - mcp__digitalocean__list_droplets
  - mcp__digitalocean__create_droplet
```

2. –í `mcp_voice_prompts.yaml` –∏–∑–º–µ–Ω–∏—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–π droplets:

```yaml
- name: "droplets"
  triggers:
    - "–¥—Ä–æ–ø–ª–µ—Ç—ã"
    - "—Å–µ—Ä–≤–µ—Ä—ã"
  action: "mcp__digitalocean__list_droplets"
  # –£–¥–∞–ª–∏—Ç–µ fallback_message
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–≤–µ—Ç–æ–≤

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `response_template` –≤ –Ω—É–∂–Ω–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏:

```yaml
response_template: |
  üéØ **–í–∞—à–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
  {% for app in apps %}
  ‚ñ´Ô∏è {{app.name}} ({{app.region}})
  {% endfor %}
```

## –ì–æ—Ä—è—á–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞

–ü—Ä–æ–º–ø—Ç—ã –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞:

```python
# –í –∫–æ–¥–µ
claude_code_service.reload_prompts()
```

–ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å admin –∫–æ–º–∞–Ω–¥—É:
```python
# /reload_prompts
if command == "/reload_prompts":
    claude_code_service.reload_prompts()
    return "‚úÖ –ü—Ä–æ–º–ø—Ç—ã –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω—ã"
```

## –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏

```bash
python3 test_yaml_prompts.py
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í –ª–æ–≥–∞—Ö –±—É–¥—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:
- `‚úÖ –ü—Ä–æ–º–ø—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω—ã` - –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
- `‚ö†Ô∏è YAML —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω` - –µ—Å–ª–∏ —Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ YAML` - –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞

### –í–∞–ª–∏–¥–∞—Ü–∏—è YAML

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:
```bash
python3 -c "import yaml; yaml.safe_load(open('data/mcp_voice_prompts.yaml'))"
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–¢—Ä–∏–≥–≥–µ—Ä—ã**: –î–æ–±–∞–≤–ª—è–π—Ç–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ñ—Ä–∞–∑
   ```yaml
   triggers:
     - "–ø–æ–∫–∞–∂–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
     - "—Å–ø–∏—Å–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"
     - "–º–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
     - "apps"
   ```

2. **Fallback**: –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π—Ç–µ `default_response` –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

3. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `requires_context: true` –¥–ª—è –∫–æ–º–∞–Ω–¥, —Ç—Ä–µ–±—É—é—â–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å –ø–æ–º–æ—â—å—é `test_yaml_prompts.py`

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ MCP —Å–µ—Ä–≤–µ—Ä–∞

1. –î–æ–±–∞–≤—å—Ç–µ –≤ `claude_sdk_prompts.yaml`:
   ```yaml
   allowed_tools:
     new_service:
       category:
         - mcp__new_service__function
   ```

2. –î–æ–±–∞–≤—å—Ç–µ –º–∞–ø–ø–∏–Ω–≥–∏ –∫–æ–º–∞–Ω–¥:
   ```yaml
   command_mappings:
     "/mcp new":
       prompt: "Execute new service command"
       tools: ["mcp__new_service__function"]
   ```

### –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–æ–≤:
```yaml
scenarios:
  - name: "applications"
    triggers_ru:
      - "–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
    triggers_en:
      - "applications"
      - "apps"
```

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –∫–æ–º–∞–Ω–¥

–í—Å–µ —Å—Ç–∞—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ legacy –º–µ—Ç–æ–¥–∞—Ö:
- `_get_legacy_voice_prompt()`
- `_get_legacy_mcp_prompt()`
- `_get_legacy_allowed_tools()`

–û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ fallback, –µ—Å–ª–∏ YAML –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω.