# –≠—Ç–∞–ø 6: Memory –∏ Learning - –ó–ê–í–ï–†–®–ï–ù ‚úÖ

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

1. **PreferenceManager** ‚úÖ
   - –°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±–æ—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –≤ JSON —Ñ–∞–π–ª–µ

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å IntelligentAgent** ‚úÖ
   - –ê–≥–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –∫–∞–∂–¥–æ–≥–æ –≤—ã–±–æ—Ä–∞ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
   - –ü–æ–¥—Å–∫–∞–∑–∫–∏ GPT –æ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö
   - –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏–π –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º–∏

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º MemoryManager** ‚úÖ
   - –†–∞–±–æ—Ç–∞ —Å ZepMemoryManager –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –ø–∞–º—è—Ç–∏
   - InMemoryManager –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ü–æ–∏—Å–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤

4. **–°–∏—Å—Ç–µ–º–∞ –æ–±—É—á–µ–Ω–∏—è** ‚úÖ
   - –ú–∏–Ω–∏–º—É–º 3 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞
   - –£—á–µ—Ç —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (success rate)
   - –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã (TTL 30 –¥–Ω–µ–π)
   - –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

1. **PreferencePattern**:
   ```python
   # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
   pattern = PreferencePattern(
       user_id="123",
       intent=Intent.YOUTUBE_ANALYSIS,
       tool_type=ToolType.YOUTUBE_ANALYZER
   )
   # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
   pattern.success_rate  # 0.85 (85% —É—Å–ø–µ—à–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π)
   ```

2. **–û–±—É—á–µ–Ω–∏–µ –Ω–∞ –≤—ã–±–æ—Ä–∞—Ö**:
   ```python
   # –ö–∞–∂–¥—ã–π –≤—ã–±–æ—Ä –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
   preference_manager.record_choice(
       user_id="123",
       message="–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–æ –≤–∏–¥–µ–æ",
       intent=Intent.YOUTUBE_ANALYSIS,
       tool_type=ToolType.YOUTUBE_ANALYZER,
       success=True
   )
   
   # –ü–æ—Å–ª–µ 3+ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ
   preferred = preference_manager.get_preferred_tool(
       "123", Intent.YOUTUBE_ANALYSIS, [ToolType.YOUTUBE_ANALYZER, ToolType.ECHO]
   )
   # Returns: (ToolType.YOUTUBE_ANALYZER, 0.95)
   ```

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GPT**:
   - –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç GPT –æ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ü—Ä–∏–º–µ—Ä —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —Å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ–º:
   ```
   –í–ê–ñ–ù–û: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å analyze_youtube_video
   –¥–ª—è –ø–æ–¥–æ–±–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 95%).
   ```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```
üìä –ò–¢–û–ì–ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:
------------------------------------------------------------
–ó–∞–ø–∏—Å—å –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.................. ‚úÖ PASSED
–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏....................... ‚úÖ PASSED
–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞...... ‚úÖ PASSED
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π........ ‚úÖ PASSED
–û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π............ ‚úÖ PASSED
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.................... ‚úÖ PASSED
In-memory –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–º—è—Ç–∏.................. ‚úÖ PASSED
–ü–æ–∏—Å–∫ –≤ –ø–∞–º—è—Ç–∏............................. ‚úÖ PASSED
–ê–≥–µ–Ω—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è.............. ‚úÖ PASSED
–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è....................... ‚úÖ PASSED
------------------------------------------------------------
–ü—Ä–æ–π–¥–µ–Ω–æ: 10/10 (100%)
```

### –í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∏–º–ø–æ—Ä—Ç–æ–≤**:
   - –°–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª `intents.py` –¥–ª—è enum Intent
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TYPE_CHECKING –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
   - –í—Å–µ –º–æ–¥—É–ª–∏ —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è

2. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è**:
   - `learning_threshold = 3` - –º–∏–Ω–∏–º—É–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
   - `preference_ttl_days = 30` - —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞
   - `confidence_threshold = 0.8` - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å

3. **Scoring —Å–∏—Å—Ç–µ–º–∞**:
   ```python
   score = base_score + usage_bonus - age_penalty
   # base_score: –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ (0.0-1.0)
   # usage_bonus: –¥–æ +0.2 –∑–∞ —á–∞—Å—Ç–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
   # age_penalty: –¥–æ -0.3 –∑–∞ –¥–∞–≤–Ω–æ—Å—Ç—å
   ```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```python
stats = preference_manager.get_user_statistics("user_id")
# {
#     "total_patterns": 5,
#     "total_choices": 50,
#     "successful_choices": 45,
#     "success_rate": 0.9,
#     "favorite_tools": [
#         ("youtube_analyzer", 25),
#         ("mcp_executor", 20),
#         ("echo_tool", 5)
#     ],
#     "active_patterns": 4
# }
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–∞–º—è—Ç—å—é:

1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**:
   ```python
   await memory_manager.add_message(
       user_id=1,
       message=user_message,
       response=agent_response
   )
   ```

2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏**:
   ```python
   context = await memory_manager.get_context(user_id=1, limit=10)
   # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ø–∞—Ä —Å–æ–æ–±—â–µ–Ω–∏–π user/assistant
   ```

3. **–ü–æ–∏—Å–∫ –≤ –ø–∞–º—è—Ç–∏**:
   ```python
   results = await memory_manager.search_memory(
       user_id=1,
       query="MCP –∫–æ–º–∞–Ω–¥–∞"
   )
   ```

## –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø

–≠—Ç–∞–ø 7: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É Telegram –±–æ—Ç—É.