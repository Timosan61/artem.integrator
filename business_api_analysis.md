# –ê–Ω–∞–ª–∏–∑ Business API –ø—Ä–æ–±–ª–µ–º—ã: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∞–≥–µ–Ω—Ç–∞"

## –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ (–ª–æ–∫–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –∫–æ–¥–µ:

1. **–§—É–Ω–∫—Ü–∏—è `send_business_message()`** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä—è–º—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ Telegram API
   - –í–∫–ª—é—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `business_connection_id`
   - –ò–º–µ–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫
   - –õ–æ–≥–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ Business —Å–æ–æ–±—â–µ–Ω–∏–π**:
   - `_handle_business_message()` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç `business_connection_id`
   - –ü–µ—Ä–µ–¥–∞–µ—Ç —Ñ–ª–∞–≥ `is_business=True`
   - –í—ã–∑—ã–≤–∞–µ—Ç `send_business_message()` –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞

3. **Webhook –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
   - `allowed_updates` –≤–∫–ª—é—á–∞–µ—Ç `business_message` –∏ `business_connection`
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–∞–∑–ª–∏—á–∞–µ—Ç —Ç–∏–ø—ã update

4. **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤**:
   - Business —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–º–µ—á–∞—é—Ç—Å—è —Ñ–ª–∞–≥–æ–º `is_business_message=True`
   - Metadata —Å–æ–¥–µ—Ä–∂–∏—Ç `business_connection_id`

### ‚ùì –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

## 1. –ü—Ä–æ–±–ª–µ–º—ã –¥–µ–ø–ª–æ—è –Ω–∞ DigitalOcean
**–°–∏–º–ø—Ç–æ–º—ã**: –ö–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –∏ –∑–∞–ø—É—â–µ–Ω–æ
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ runtime –ª–æ–≥–∞—Ö

**–†–µ—à–µ–Ω–∏–µ**: `./get_digitalocean_logs.sh`

## 2. Webhook –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å Business —Å–æ–±—ã—Ç–∏—è–º–∏
**–°–∏–º–ø—Ç–æ–º—ã**: Business —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ webhook
**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- Webhook URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- `allowed_updates` –≤–∫–ª—é—á–∞–µ—Ç Business —Å–æ–±—ã—Ç–∏—è
- Telegram –ø–æ–ª—É—á–∞–µ—Ç webhook updates

**–†–µ—à–µ–Ω–∏–µ**: `./check_and_setup_webhook.py`

## 3. Business API –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Telegram
**–°–∏–º–ø—Ç–æ–º—ã**: –ù–µ—Ç Business –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- Telegram Premium –∞–∫–∫–∞—É–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –ë–æ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω –≤ Settings ‚Üí Business ‚Üí Chatbots
- Business connection –∞–∫—Ç–∏–≤–Ω–æ

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Telegram

## 4. –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–æ–∫–µ–Ω–æ–º –±–æ—Ç–∞
**–°–∏–º–ø—Ç–æ–º—ã**: HTTP –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ
**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- `TELEGRAM_BOT_TOKEN` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –£ –±–æ—Ç–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ Business API
- –¢–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫

## 5. –û—à–∏–±–∫–∏ –≤ –æ—Ç–ø—Ä–∞–≤–∫–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
**–°–∏–º–ø—Ç–æ–º—ã**: Timeout –∏–ª–∏ connection errors
**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ DigitalOcean
- Firewall –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- DNS —Ä–µ–∑–æ–ª—é—Ü–∏—è api.telegram.org

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–ø–ª–æ–π DigitalOcean
```bash
./get_digitalocean_logs.sh
```
**–ò—Å–∫–∞—Ç—å**:
- ‚úÖ Application started
- ‚úÖ Webhook received  
- ‚ùå Business —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
- ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ Business —Å–æ–æ–±—â–µ–Ω–∏—è

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```bash  
./check_and_setup_webhook.py
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- Webhook URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- Business —Å–æ–±—ã—Ç–∏—è –≤–∫–ª—é—á–µ–Ω—ã
- –ù–µ—Ç pending errors

### –®–∞–≥ 3: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Business –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
–í –±–æ—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å: `/business_status`
**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- –ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ Business –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- Connection ID –¥–æ—Å—Ç—É–ø–Ω—ã

### –®–∞–≥ 4: –û—Ç–ª–∞–¥–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ Business —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ DigitalOcean:
   ```bash
   ./doctl apps logs <APP_ID> --type run --follow
   ```
3. –ò—Å–∫–∞—Ç—å:
   - üì± –û–±—Ä–∞–±–æ—Ç–∫–∞ Business —Å–æ–æ–±—â–µ–Ω–∏—è
   - üì§ Sending Business response
   - ‚úÖ Business —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
   - ‚ùå –õ—é–±—ã–µ –æ—à–∏–±–∫–∏

## –ù–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ** (70% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å)
2. **Webhook –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å Business —Å–æ–±—ã—Ç–∏—è–º–∏** (20% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å)  
3. **Business API –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Telegram** (10% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å)

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É DigitalOcean –ª–æ–≥–æ–≤
2. –ù–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–≥–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ—á–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É
3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º Business —Å–æ–æ–±—â–µ–Ω–∏–µ–º